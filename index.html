<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Voice Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f4f8;
        }
        
        .info-box {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .error { border-left-color: #e74c3c; }
        .success { border-left-color: #2ecc71; }
        .warning { border-left-color: #f39c12; }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        #result {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            min-height: 50px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>üîç Voice to Text Debug Test</h1>
    
    <div class="info-box">
        <h3>Info Browser:</h3>
        <p id="browserInfo">Loading...</p>
    </div>
    
    <div class="info-box">
        <h3>Status API:</h3>
        <p id="apiStatus">Checking...</p>
    </div>
    
    <div class="info-box">
        <h3>HTTPS Status:</h3>
        <p id="httpsStatus">Checking...</p>
    </div>
    
    <div class="info-box">
        <h3>Microphone Permission:</h3>
        <p id="micStatus">Not checked</p>
        <button id="checkMicBtn">Check Microphone</button>
    </div>
    
    <div class="info-box">
        <h3>Speech Recognition Test:</h3>
        <button id="testSpeechBtn" disabled>Test Speech Recognition</button>
        <div id="result">Hasil akan muncul di sini...</div>
    </div>

    <script>
        // Get browser info
        document.getElementById('browserInfo').textContent = navigator.userAgent;
        
        // Check HTTPS
        const httpsStatus = document.getElementById('httpsStatus');
        if (location.protocol === 'https:') {
            httpsStatus.textContent = '‚úÖ HTTPS - OK';
            httpsStatus.parentElement.className = 'info-box success';
        } else {
            httpsStatus.textContent = '‚ùå HTTP - Speech API butuh HTTPS di mobile';
            httpsStatus.parentElement.className = 'info-box error';
        }
        
        // Check API support
        const apiStatus = document.getElementById('apiStatus');
        let speechSupported = false;
        
        if ('webkitSpeechRecognition' in window) {
            apiStatus.textContent = '‚úÖ webkitSpeechRecognition supported';
            apiStatus.parentElement.className = 'info-box success';
            speechSupported = true;
        } else if ('SpeechRecognition' in window) {
            apiStatus.textContent = '‚úÖ SpeechRecognition supported';
            apiStatus.parentElement.className = 'info-box success';
            speechSupported = true;
        } else {
            apiStatus.textContent = '‚ùå Speech Recognition tidak didukung di browser ini';
            apiStatus.parentElement.className = 'info-box error';
        }
        
        // Check microphone permission
        const checkMicBtn = document.getElementById('checkMicBtn');
        const micStatus = document.getElementById('micStatus');
        
        checkMicBtn.addEventListener('click', async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop());
                micStatus.textContent = '‚úÖ Microphone permission granted';
                micStatus.parentElement.className = 'info-box success';
                
                if (speechSupported) {
                    document.getElementById('testSpeechBtn').disabled = false;
                }
            } catch (error) {
                micStatus.textContent = '‚ùå Microphone permission denied: ' + error.message;
                micStatus.parentElement.className = 'info-box error';
            }
        });
        
        // Test speech recognition
        const testSpeechBtn = document.getElementById('testSpeechBtn');
        const result = document.getElementById('result');
        
        testSpeechBtn.addEventListener('click', () => {
            if (!speechSupported) {
                result.textContent = '‚ùå Speech Recognition tidak didukung';
                return;
            }
            
            try {
                const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'id-ID';
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onstart = function() {
                    result.textContent = 'üé§ Mendengarkan... (bicara sekarang)';
                    testSpeechBtn.textContent = 'Sedang mendengarkan...';
                    testSpeechBtn.disabled = true;
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    result.textContent = '‚úÖ Hasil: ' + transcript;
                };
                
                recognition.onerror = function(event) {
                    result.textContent = '‚ùå Error: ' + event.error;
                };
                
                recognition.onend = function() {
                    testSpeechBtn.textContent = 'Test Speech Recognition';
                    testSpeechBtn.disabled = false;
                };
                
                recognition.start();
            } catch (error) {
                result.textContent = '‚ùå Error starting recognition: ' + error.message;
            }
        });
        
        // Show specific mobile warnings
        const userAgent = navigator.userAgent;
        if (userAgent.includes('iPhone') || userAgent.includes('iPad')) {
            const warning = document.createElement('div');
            warning.className = 'info-box error';
            warning.innerHTML = '<h3>‚ö†Ô∏è iOS Safari Warning:</h3><p>Safari di iOS tidak mendukung Web Speech API. Coba gunakan Chrome atau Firefox di iOS.</p>';
            document.body.insertBefore(warning, document.body.firstChild);
        }
    </script>
</body>
</html>